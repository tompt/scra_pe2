!function(a,b){"use strict";var c=function(){this.version="1.0.0",this.options={testUrls:["//pub.sapo.pt/ajs.php?zoneid=5129&cb=58121362915&charset=UTF-8&loc="+encodeURIComponent(a.location.href)],elmClasses:["textAd","textAd3","textAdBG","textAdBlock","textAdBlwPgnGrey","textAdBox","textAdMinimum","textAds","textLinkAd","textSponsor","text_ad","text_ad_description","text_ad_title","text_ad_website","text_ads","textad_headline","teaser-ad","teaser-sponsor","teaserAdContainer","teaserAdHeadline","teaser_adtiles","teaser_advert_content","text-ad","text-ad-300","text-ad-links","text-ad-links2","text-ad-top","text-ads","text-advertisement","text-g-advertisement","text-g-group-short-rec-ad","text-g-net-group-news-half-page-ad-300x600-or-300x250","text-g-net-grp-google-ads-article-page","text-g-nn-web-group-ad-halfpage","text-g-sponsored-ads","text-g-sponsored-links","promoAds","promoAdvertising","promo_ad","promo_border","promoad","promoboxAd","promotionTextAd","proof_ad","ps-ad","ps-ligatus_placeholder","pt_ad03","pt_col_ad02","pub_300x250","pub_300x250m","pub_728x90","publiboxright300","publication-ad","publicidadSuperior","publicidad_horizontal","publicidade"],elmStyle:"height: 1px !important; width: 1px !important; position: absolute; top: -999999px; left: -999999px;",debug:!1,checkOnLoad:!0,modalCheckFrequency:2,configUrl:"//js.sapo.pt/Projects/sapoabd2/messages.json"},this.state={bait:null,detections:[],modal:null,modalWasShown:!1,cookie:null,tamperTimer:null,stopTimer:null,status:null,checking:!1,loginWasClicked:null,continueWasClicked:null,messages:null,isLogged:null},this.adbDetected=!1,this.config={imageUrl:"//ww1510.smartadserver.com/ac?nwid=0&siteid=131563&pgid=740346&fmtid=41262",reportUrl:"//jsphp.sapo.pt/sapoabd/img.php",cssElmId:"sapoabd-css",modalId:"sapoabd-modal"+Math.floor(1e7*Math.random()+1),tamperCheckFrequency:1,protocol:"https:"===a.location.protocol?"https:":"http:",messagesMode:"enforce"},this.init=function(c){this.setOption(c),this.options.checkOnLoad===!0?/loaded|complete/.test(b.readyState)?this.start():void 0!==a.addEventListener?a.addEventListener("load",this.start.bind(this),!1):a.attachEvent("onload",this.start.bind(this)):this.debug("warn","not checking on load")}};c.prototype={finishedEvent:function(){this.debug("info","FINISHED! Emitting finishedEvent..");var a;b.createEvent?(a=b.createEvent("HTMLEvents"),a.initEvent("adbCheckFinished",!0,!0)):(a=b.createEventObject(),a.eventType="adbCheckFinished"),a.eventName="adbCheckFinished",a.state=this.hasActiveBlocker(),b.createEvent?b.body.dispatchEvent(a):b.body.fireEvent("on"+a.eventType,a)},start:function(){this.debug("warn","Debugging is on."),this.debug("info","Dom is ready"),null===this.state.bait&&this.getMessages()},stop:function(){this.debug("warn","Stopping checks.");var b=a.setInterval(function(){this.state.checking===!1&&this.report(!0)}.bind(this),1e3);this.state.stopTimer=b},jsonP:function(c,d){var e={};return e.send=function(c,d){function e(){a.clearTimeout(i),j.parentNode.removeChild(j)}var f=d.callbackName||"callback",g=d.onSuccess||function(){},h=d.timeout||10,i=setTimeout(e,1e3*h);a[f]=function(a){e(),g(a)};var j=b.createElement("script");j.type="text/javascript",j.async=!0,j.src=c,j.id="sapoabd-status",b.getElementsByTagName("head")[0].appendChild(j)},e.send(c,d),e},objectAssign:function(a){if(void 0===a||null===a)throw new TypeError("Cannot convert undefined or null to object");for(var b=Object(a),c=1;c<arguments.length;c++){var d=arguments[c];if(void 0!==d&&null!==d)for(var e in d)d.hasOwnProperty(e)&&(b[e]=d[e])}return b},addEventListener:function(a,b,c){a.addEventListener?a.addEventListener.call(a,b,c,!0):a.attachEvent.call(a,b,c)},getOption:function(a){var b=this.objectAssign({},this.options);return void 0!==a?b[a]:b},setOption:function(a,b){if(void 0!==b){var c=a;a={},a[c]=b}for(var d in a)this.options[d]=a[d],this.debug("info",'The value of "'+a[d]+'" was assigned to the "'+d+'" option.');return this.options.config&&!this.options.config.pubReplace&&(delete this.options.config.pubSelector,delete this.options.config.pubReplace),this},startChecks:function(a){function b(){0===--c&&a()}this.debug("info","Starting a new check");var c=2;this.checkElm(b),this.checkXMLHttpRequest(b),this.checkImage(b)},getMessages:function(){if(this.options.config)this.handleMessages(this.options.config);else{var b=new XMLHttpRequest,c=function(){}.bind(this),d=function(){var c=JSON.parse(b.responseText);c=this.objectAssign({},c["default"],c[a.location.hostname]),this.handleMessages(c)}.bind(this);this.addEventListener(b,"error",c),this.addEventListener(b,"load",d),b.open("GET",this.config.protocol+this.options.configUrl),b.send()}},handleMessages:function(a){this.state.messages=a,this.debug("info","ShowModal Flag: "+this.state.messages.showModal),this.getCookies(),this.startChecks(function(){this.checkAuth()}.bind(this))},checkAuth:function(){this.debug("info","Checking if the user is logged in.");var a=function(a){this.debug("warn","Got login status from server."),this.status(a)}.bind(this),b="checkAuthCb"+Math.floor(1e9*Math.random()+1e9);this.jsonP("https://login.sapo.pt/CS.do?jsonCallback="+b,{callbackName:b,onSuccess:a,timeout:5})},status:function(a){this.state.status=a,a.auth===!0&&(this.state.isLogged=!0),this.state.detections.length>0?(this.state.messages.showModal&&(this.debug("info","Ad blocker detected"),this.getCss(),a.auth===!1?(this.debug("info","User is not logged in."),this.showModal(!1)):this.state.messages.afterloginmodal?(this.debug("info","User is logged in."),this.showModal(!0)):this.stop.call(this)),this.state.messages.pubSelector&&this.state.messages.pubReplace&&this.showpubReplace(),this.report()):(this.debug("info","Ad blocker not detected or showModal flag is false"),this.stop.call(this))},checkElm:function(){this.debug("info","Checking bait element."),this.state.checks=!0,null===this.state.bait&&this.createBaitElement();var b=a.getComputedStyle(this.state.bait);"none"===b.display||"hidden"===b.visibility?this.onDetected("CSS Tampering"):void 0!==b.MozBinding&&"none"!==b.MozBinding?this.onDetected("CSS Tampering"):this.onUndetected("bait elememt CSS tampering"),this.state.checks=!1},createBaitElement:function(){var c=this.getElmClasses(this.options.elmClasses.length),d=b.createElement("div");d.setAttribute("class",c),d.setAttribute("style",this.options.elmStyle),d.setAttribute("id","bait"),this.state.bait=a.document.body.appendChild(d),this.debug("info","A new bait element was created")},removeBaitElement:function(){this.state.bait&&a.document.body.removeChild(this.state.bait),this.state.bait=null,this.debug("info","Bait element was removed.")},getElmClasses:function(a){for(var b="",c=0;c<Math.floor(11*Math.random())+0;c++){var d=Math.floor(Math.random()*a);b+=this.options.elmClasses[d]+" "}return b.trim()},checkXMLHttpRequest:function(a){if(this.debug("info","Checking ajax request blocking."),this.state.checks=!0,void 0!==this.options.testUrls)for(var b=this.options.testUrls.length,c=function(){this.onDetected("XMLHttpRequest Blocking"),0===--b&&a()}.bind(this),d=function(){0===this.state.detections.length&&this.onUndetected(),0===--b&&a()}.bind(this),e=0;e<this.options.testUrls.length;e++){var f=new XMLHttpRequest;this.addEventListener(f,"error",c),this.addEventListener(f,"load",d),f.open("GET",this.options.testUrls[e]);try{f.send()}catch(g){return this.onDetected("XMLHttpRequest Blocking"),void(this.state.checks=!1)}finally{this.onUndetected("XMLHttpRequest Blocking")}}this.state.checks=!1},checkImage:function(a){var c=b.createElement("img"),d=function(){c.parentNode?c.parentNode.removeChild(c):this.onDetected("Image redirect"),a()}.bind(this);c.setAttribute("src",this.config.imageUrl),c.onload=function(){this.onDetected("Image redirect"),d()}.bind(this),c.onerror=function(){d()}.bind(this),c.setAttribute("style",this.options.elmStyle),b.getElementsByTagName("body")[0].appendChild(c)},onDetected:function(a){this.adbDetected=!0,this.state.detections.push({type:a,time:(new Date).toTimeString()}),this.debug("info","We've detected a "+a+" event.")},onUndetected:function(a){this.adbDetected=!1,this.debug("info","We havent't detected "+a+".")},report:function(b){var c,d,e;c=null!==this.state.cookie?"sapoabd-g cookie was present. ":"sapoabd-g was not present. ",d=null!==this.state.loginWasClicked?"The login button was pressed. ":"The login button was not pressed. ",e=this.state.detections.length>0?"We detected an active adblocker. ":"We didn't detect an active adblocker. ",this.debug("info","Reporting results: "+a.location.host+" "+e+c+d);var f=function(a){}.bind(this),g=function(){this.debug("info","Report success event comes from this.stop method? : "+b),b&&(null!==this.state.loginWasClicked?this.cleanUp(!0):this.cleanUp(null))}.bind(this),h=new XMLHttpRequest;this.addEventListener(h,"error",f),this.addEventListener(h,"load",g);var i=this.state.detections.length>0?"d=1":"d=0";i+="&s="+a.location.host,i+=null!==this.state.cookie?"&g=1":"&g=0",i+=null!==this.state.loginWasClicked?"&l=1":"&l=0",i+=null!==this.state.continueWasClicked?"&c=1":"&c=0",i+=this.state.messages.showModal===!0?"&sm=1":"&sm=0",i+=null!==this.state.isLogged?"&il=1":"&il=0",h.open("GET",this.config.protocol+this.config.reportUrl+"?"+i),h.send(),this.finishedEvent()},getCss:function(){if(this.state.messages.css){var a=b.createElement("link");a.setAttribute("rel","stylesheet"),a.setAttribute("type","text/css"),a.setAttribute("href",this.state.messages.css),a.setAttribute("id",this.config.cssElmId),b.head.appendChild(a),this.debug("info","Modal window css was loaded.")}},removeCss:function(){var a=b.getElementById(this.config.cssElmId);null!==a&&(b.head.removeChild(a),this.debug("info","Modal window css was removed."))},assembleModal:function(c){var d,e,f,g;f=b.createElement("div"),f.setAttribute("class","modal-body"),f.innerHTML=this.state.messages.type[this.config.messagesMode].message,e=b.createElement("div"),e.setAttribute("class","modal-wrapper"),e.appendChild(f),d=b.createElement("div"),d.setAttribute("id",this.config.modalId),d.style.opacity=0,d.appendChild(e),this.state.modal=b.body.appendChild(d),g=b.getElementById("modal-login"),"enforce"===this.config.messagesMode&&(c===!0?(g.innerText="Continuar",g.href="#"):(g.innerText="Login",g.href=this.config.protocol+"//login.sapo.pt/Login.do?to="+encodeURIComponent(a.location.href))),this.debug("info","Creating modal window markup."),this.setupLoginEventListener()},setupLoginEventListener:function(){var a=b.getElementById("modal-login");this.debug("info","Adding button event listener."),this.state.status.auth===!0?this.addEventListener(a,"click",function(a){a.preventDefault(),this.state.continueWasClicked=!0,this.debug("info","The continue button was clicked."),this.stop()}.bind(this)):this.addEventListener(a,"click",function(a){a.preventDefault(),this.state.loginWasClicked=!0,this.debug("info","The login button was clicked."),this.stop()}.bind(this))},showModal:function(a){this.assembleModal(a),this.debug("info","Showing modal window"),null===this.state.cookie&&this.setCookie(),null!==this.state.modal&&null!==b.getElementById(this.config.modalId)||this.assembleModal(),this.state.modal.style.opacity=1,this.state.modal.style.zIndex=1e4,this.state.modalWasShown=!0,setTimeout(this.checkModalTampering(),100)},showpubReplace:function(){for(var a,c=b.querySelectorAll(this.state.messages.pubSelector),d=0,e=c.length;d<e;d++)a=c[d],a.className+=(a.className?" ":"")+"adb-inline-warning",a.innerHTML=this.state.messages.pubReplace},removeModal:function(){null!==this.state.modal&&b.body.removeChild(this.state.modal),this.debug("info","Modal window was removed.")},checkModalTampering:function(){if(this.state.modalWasShown===!0){var c=/rgba\(0, ?0, ?0, ?0?\.85[\d]*\)/i;this.state.tamperTimer=a.setInterval(function(){this.debug("info","Checking if the modal window has been tampered with.");var d=b.getElementById(this.config.modalId);if(null!==d){var e=a.getComputedStyle(d);"block"!==e.display&&(d.style.display="block",this.debug("warn","Display CSS property was tampered with. Resetting")),"10000"!==e.zIndex&&(d.style.zIndex="10000",this.debug("warn","Z-index CSS property was tampered with. Resetting")),"1"!==e.opacity&&(d.style.opacity="1",this.debug("warn","Opacity CSS property was tampered with. Resetting")),"visible"!==e.visibility&&(d.style.visibility="visible",this.debug("warn","Visibility CSS property was tampered with. Resetting")),"fixed"!==e.position&&(d.style.position="fixed",this.debug("warn","Position CSS property was tampered with. Resetting")),"0px"!==e.top&&(d.style.top="0px",this.debug("warn","Top CSS property was tampered with. Resetting")),"0px"!==e.right&&(d.style.right="0px",this.debug("warn","Right CSS property was tampered with. Resetting")),"0px"!==e.bottom&&(d.style.bottom="0px",this.debug("warn","Bottom CSS property was tampered with. Resetting")),"0px"!==e.left&&(d.style.left="0px",this.debug("warn","Left CSS property was tampered with. Resetting"));var f=e.backgroundColor.match(c);null!==f&&1!==f.length&&(d.style.backgroundColor="rgba(0,0,0,0.85)",this.debug("warn","BackgroundColor CSS property was tampered with. Resetting"))}else this.debug("warn","Modal window was deleted by user. Resetting."),this.showModal()}.bind(this),1e3*this.options.modalCheckFrequency)}},getCookies:function(){if(this.debug("info",'Checking if the "sapoabd-g" cookie exists.'),b.cookie.length>0){for(var a=b.cookie.split("; "),c=0;c<a.length;c++)a[c].indexOf("sapoabd-g")>-1&&(this.state.cookie=a[c].split("=")[1],this.debug("info",'The "sapoabd-g" cookie is present.'));return a.length}return!1},setCookie:function(){var a=new Date;a.setTime(a.getTime()+2592e6),b.cookie="sapoabd-g=1; path=/; expires="+a.toUTCString()+";",this.debug("info",'Setting the "sapoabd-g" cookie.')},cleanUp:function(b){this.debug("warn","Cleaning up."),this.removeBaitElement(),this.removeCss(),this.removeModalTamperingTimer(),this.removeStopTimer(),null!==b?a.location=this.config.protocol+"//login.sapo.pt/Login.do?to="+encodeURIComponent(a.location.href):this.removeModal(),this.state=null},removeModalTamperingTimer:function(){this.debug("info","Removing modal tampering detection timer."),clearInterval(this.state.tamperTimer),this.state.tamperTimer=null},removeStopTimer:function(){this.debug("info","Removing detection is finished timer."),clearInterval(this.state.stopTimer),this.state.stopTimer=null},debug:function(a,b){if(this.options.debug===!0)switch(a){case"log":console.log("[SapoABD] - "+b);break;case"info":console.info("[SapoABD] - "+b);break;case"warn":console.warn("[SapoABD] - "+b);break;case"error":console.error("[SapoABD] - "+b)}},hasActiveBlocker:function(){return this.adbDetected}};var d=function(a){var b=new c;this.init=b.init.bind(b),this.getOption=b.getOption.bind(b),this.setOption=b.setOption.bind(b),this.hasActiveBlocker=b.hasActiveBlocker.bind(b),this.init(a)},e=b.getElementById("sapo-abd-script")||Array.prototype.slice.call(b.getElementsByTagName("script"),-1)[0],f=e.getAttribute("data-auto-load");null!==f&&void 0!==f&&"false"!==f&&new d,a.SapoABD=d}(window,document);